

     

<% fields_for "re_task[subtask_attributes][]", re_subtask do |re_subtask_form| %>
    <% if(re_subtask.id) %>
        <%  index = re_subtask.id %>
    <% else %>
        <% if(@re_subtask_with_clicked_link) %>   <%# if ne task is not new and a before or after link was pressed at a subtask%>
            <% index = "new_#{@add_position}_#{@re_subtask_with_clicked_link.re_artifact_properties.id}_"+Time.now.to_i.to_s %>
        <% else %>   <%# if ne task is new or has no subtasks yet%>
            <% index = "new_#{@add_position}_newtask_"+Time.now.to_i.to_s %>
        <% end %>
    <% end %>
    
    <% type = 'odd' %>
    <% type = 'variant' if re_subtask.sub_type == 1 %>
    <% type = 'problem' if re_subtask.sub_type == 2 %>

    <% if re_subtask.id %>
        <%= "<tr id=\"subtask_drag_#{index}\" class=\"draggable #{type}\" > " %>
    <% else %>
        <%= "<tr id=\"subtask_drag_#{index}\" class=\"#{type}\" > " %>
    <% end %>
          <td style="cursor: pointer;"></td>
          <td>
            <%= select_tag("re_task[subtask_attributes][#{index}][sub_type]", options_for_select([['ST',0],['V', 1],['P',2]], re_subtask.sub_type ), :onchange => "changeSubtaskRowColor($('subtask_drag_#{index}'), this.value)" ) %>
          </td>
          <td>
              <%= text_area_tag "re_task[subtask_attributes][#{index}][name]", re_subtask.name, {:cols => 40, :rows => 1, :class => "subtask"} %> <%#= re_subtask_form.text_field :name %>
          </td> 
          <td>
              <%= text_area_tag "re_task[subtask_attributes][#{index}][solution]", re_subtask.solution, {:cols => 40, :rows => 1, :class => "subtask"} %><%#= re_subtask_form.text_field :solution %>
          </td>
          <td>
              <%= link_to_remote l(:re_delete_subtask), :url => {:action => "delete_subtask", :id => index}, :html=> {:class => "icon icon-del"} %>
          <% if re_subtask.id %>
              <%= link_to_remote l(:re_insert_st_after), :url => {:action => "add_subtask", :id => index, :add_position => :after}, :html=> {:class => "icon icon-subtask-after"} %>
          <% end %>
          </td>
        </tr>
  <% end %>
