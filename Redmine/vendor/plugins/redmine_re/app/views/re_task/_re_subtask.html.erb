                                                                      
<% fields_for "re_task[subtask_attributes][]", re_subtask do |re_subtask_form| %>
    <% if(re_subtask.id) %>
        <%  @index = re_subtask.id %>
    <% else %>
        <% if(@re_subtask_with_clicked_link) %>   <%# if ne task is not new and a before or after link was pressed at a subtask%>
            <% @index = "new_#{@add_position}_#{@re_subtask_with_clicked_link.re_artifact_properties.id}_"+Time.now.to_i.to_s %>
        <% else %>   <%# if ne task is new or has no subtasks yet%>
            <% @index = "new_#{@add_position}_newtask_"+Time.now.to_i.to_s %>
        <% end %>
    <% end %>

    <% if re_subtask.id %>
        <%= "<div id=\"subtask_drag_#{@index}\" class=\"draggable\" > " %>
    <% else %>
        <%= "<div id=\"subtask_drag_#{@index}\"  > " %>
    <% end %>
                  <% if re_subtask.sub_type == 0 %>  <%= "<div id=\"subtask_#{@index}\" class=\"subtask\"> " %><% end %>
                  <% if re_subtask.sub_type == 1 %>  <%= "<div id=\"subtask_#{@index}\" class=\"variant\"> " %><% end %>
                  <% if re_subtask.sub_type == 2 %>  <%= "<div id=\"subtask_#{@index}\" class=\"problem\"> " %><% end %>

                    <% if re_subtask.id %>
                        <%= link_to_remote " ", :url => {:action => "add_subtask", :id => @index, :add_position => :before}, :html=> {:class => "add_before"} %>
                        <%#= link_to_remote "Add Subtask before", :url => {:action => "add_subtask", :id => @index, :add_position => :before}%>
                        <%#= link_to_remote "Add Subtask after", :url => {:action => "add_subtask", :id => @index, :add_position => :after}%>
                    <% end %>
    
                    <p>
                        <%= re_subtask_form.label :name, l(:re_artifact_name) %><%= text_field_tag "re_task[subtask_attributes][#{@index}][name]", re_subtask.name %> <%#= re_subtask_form.text_field :name %>
                    </p>
                    <p>
                         <%= re_subtask_form.label :solution, l(:re_subtask_solution) %> <%= text_field_tag "re_task[subtask_attributes][#{@index}][solution]", re_subtask.solution %><%#= re_subtask_form.text_field :solution %>
                    </p>
                    <p>
                         <%= label_tag 'Subtask' %>  <%= radio_button_tag "re_task[subtask_attributes][#{@index}][sub_type]", '0', (re_subtask.sub_type == 0) %>
                    </p>
                    <p>
                        <%= label_tag 'Variante' %>  <%= radio_button_tag "re_task[subtask_attributes][#{@index}][sub_type]", '1', (re_subtask.sub_type == 1) %>
                    </p>
                    <p>
                        <%= label_tag 'Problem' %>  <%= radio_button_tag "re_task[subtask_attributes][#{@index}][sub_type]", '2', (re_subtask.sub_type == 2) %>
                    </p>
                    <% if re_subtask.id %>
                        <%= link_to_remote " ", :url => {:action => "add_subtask", :id => @index, :add_position => :after}, :html=> {:class => "add_after"} %>
                        <%#= link_to_remote "Add Subtask before", :url => {:action => "add_subtask", :id => @index, :add_position => :before}%>
                        <%#= link_to_remote "Add Subtask after", :url => {:action => "add_subtask", :id => @index, :add_position => :after}%>
                    <% end %>

              </div>
        </div>
  <% end %>
