<% content_for :header_tags do %>
    <%= stylesheet_link_tag 'sortable_tree.css', :plugin => "redmine_re", :media => 'all' %>
    <%= stylesheet_link_tag 'context_menu.css', :media => 'all' %>
    <%= javascript_include_tag 'sortable_tree.js', :plugin => 'redmine_re' %>
<% end%>
<h3><%= l(:re_tree_overview) %></h3>

<%= @html_tree %>

<script type="text/javascript">
  //<![CDATA[
    
  var tree = new SortableTree('tree', {
    droppable: {
      container: ':not(.we_are_all_containers)' /* everything specified here is able to be a container for a drop */
    },
    onDrop: function(drag, drop, event){
      var left_node_id = drag.leftNode ? drag.leftNode.id() : ''
      var parent_id = drag.parent.id();
      
      new Ajax.Request('/requirements/delegate_tree_drop', {
        parameters: {
          new_parent_id:drag.parent.id(),
          moved_artifact_id:drag.id(),
          left_artifact_id:left_node_id
        }
      });

    },
    nodeUrl: '/requirements/treestate/',
    contextMenuUrl: '/requirements/context_menu/',
    contextMenuDivId: 'context-menu',
    editUrl: '/re_artifact_properties/edit/',
    projectId: <%= @project.id -%>
  });
  if (tree !== null) {
    tree.setSortable();
    Event.observe(document.body, 'click', function() { Effect.Fade('context-menu', {duration: 0.20}) }.bindAsEventListener());
  };

  //]]>
</script>