

<div id="tree">


<script type="text/javascript">
    var treeData = <%= @jsontree.to_s %>;
</script>

  
<script type="text/javascript">

    // We declare the tree outside of the function. This way it's
    // accessible from any function
    var tree = null;

    // Tree initialisation.
    var initTree = function TafelTreeInit() {
        tree = new TafelTree('tree', treeData, {
            'generate' : true,
            'imgBase' : '<%=image_path('tafeltree', :plugin => 'redmine_re').split('?')[0] %>/',
            'width' : '100%', // default value : 100%
            'height' : 'auto', // default value : auto
            'openAtLoad' : true,
            'cookies' : false,
            'onDrop' : my_drop
        });
    }

    // This function is called automatically
    // when the page finishes to load
    // (and can be called manually on success of an ajax call
    initTree();

    function my_drop (branch_move, branch_here, drop_finished, new_branch) {
        // Beware, the function is called twice. One time before drop
        // happends, one time after. Here, we check before drop
        // happends
        if (!drop_finished) {
            // Tests
            if (true) {
                // OK, the branch will be dropped here
                return true;
            } else {
                // Here, the branch won't be dropped and will return
                // at her place
                return false;
            }
        } else {
            var request = new XMLHttpRequest();
            var url = '/requirements/delegate_tree_drop?new_parent_id=' + branch_here.getId() + ';moved_artifact_id=' + branch_move.getId();
            request.open('get', url, true);
            request.send(null)
        }
    }

</script>
</div>